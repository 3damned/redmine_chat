<div id="ChatApp"></div>


<script>
  <% ws_protocol = Setting.protocol == 'https' ? 'wss' : 'ws' %>
  var socket;
  socket = new WebSocket("<%= ws_protocol %>://" + window.location.host + "/chat/user_events" + "?token=<%= cookies[:chat_token].chomp %>");
//
//
//  socket.onclose = function (event) {
//    if (event.wasClean) {
//      alert('Соединение закрыто чисто');
//    } else {
//      alert('Обрыв соединения'); // например, "убит" процесс сервера
//    }
//    alert('Код: ' + event.code + ' причина: ' + event.reason);
//  };
//
  socket.onmessage = function (event) {
    alert("Получены данные " + event.data);
  };

  socket.onerror = function (error) {
    alert("Ошибка " + error.message);
  };

  socket.onopen = function (e) {
    return console.log('socket opened');
  };

</script>

<!--
  В папке assets/stylesheets должен быть файл chat.css
  В папке assets/javascripts должен быть файл chat.js
-->

<% content_for :header_tags do %>
  <%= stylesheet_link_tag "chat.css?#{Chat.commit_hash}", plugin: 'redmine_chat' %>

  <!-- Если нужно, чтоб js загрузился после дива, то javascript_include_tag нужно разместить за границами блока content_for -->

  <%= javascript_include_tag "chat.js?#{Chat.commit_hash}", plugin: 'redmine_chat' %>
<% end %>
